<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
 <link rel="stylesheet"
		href="http://113.140.66.230:18101/arcgis_js_v323_api/arcgis_js_api/library/3.23/3.23/dijit/themes/claro/claro.css"/>
	<link rel="stylesheet"
		href="http://113.140.66.230:18101/arcgis_js_v323_api/arcgis_js_api/library/3.23/3.23/esri/css/esri.css"/>
	<link rel="stylesheet"
		href="http://113.140.66.230:18101/arcgis_js_v323_api/arcgis_js_api/library/3.23/3.23/dijit/themes/soria/soria.css"/>
    <style>
      html, body, #mapDiv {
        padding:0;
        margin:0;
        height:100%;
      }
    </style>
    <script src="http://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="http://113.140.66.230:18101/arcgis_js_v323_api/arcgis_js_api/library/3.23/3.23/init.js"></script>
    <script>
   var map;
   $(function(){
       let poin = [108.567, 34.83];
       let pointArr = [{x: 108.567, y: 34.83,name: "废水"}, {x: 108.267, y: 34.23,name: "废水"}, {x: 108.167, y: 34.85,name: "废水"}];
       intMap(pointArr,poin)
   })
   let intMap=function(pointArr,poin) {
       require([
           "esri/map", "esri/layers/ArcGISTiledMapServiceLayer",
           "dojo/_base/array", "dojo/dom", "esri/graphic",
           "esri/tasks/query",
           "esri/tasks/QueryTask",
           "esri/layers/GraphicsLayer",
           "esri/symbols/SimpleMarkerSymbol",
           "esri/symbols/SimpleLineSymbol",
           "esri/Color",
           "esri/request",
           "esri/symbols/Font",
           "esri/layers/FeatureLayer",
           "esri/symbols/TextSymbol",
           "esri/symbols/PictureMarkerSymbol",
           "esri/InfoTemplate",
           "esri/geometry/Point",
           "esri/tasks/find",
           "dojo/on", "dojo/domReady!"
       ], function (
           Map, ArcGISTiledMapServiceLayer,
           arrayUtils,
           dom,
           Graphic,
           Query,QueryTask, GraphicsLayer,
           SimpleMarkerSymbol, SimpleLineSymbol,
           Color, esriRequest,Font, FeatureLayer,TextSymbol, PictureMarkerSymbol, InfoTemplate, Point, find, on
       ) {
           map = new Map("mapDiv", {
               maxZoom: 20,
               minZoom: 5
           });
           //添加影像
           let yxLayer = new ArcGISTiledMapServiceLayer("http://113.140.66.226:33225/arcgis/rest/services/TDTSxImgMap/MapServer");
           map.addLayer(yxLayer);
           //影像标注
           let yxbzLayer = new ArcGISTiledMapServiceLayer("http://113.140.66.226:33225/arcgis/rest/services/TDTSxBaseMap_LB/MapServer");
           map.addLayer(yxbzLayer);
           let makerSymbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CIRCLE, 10,
               new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([204, 102, 51]), 1),
               new Color([255, 0, 0, 1]));
           let graphicLayer = new GraphicsLayer();
           graphicLayer.id = "pointLayer";
           map.addLayer(graphicLayer);
           let textLayer = new GraphicsLayer();
           textLayer.id = "textLayer";
           map.addLayer(textLayer);
         if(pointArr.length>0) {
               for (var i = 0; i < pointArr.length; i++) {
                   let point = new Point(pointArr[i].x, pointArr[i].y);
                   var pictureMarkerSymbol = new PictureMarkerSymbol("images/xzcon-icon.png", 15, 20);
                   pictureMarkerSymbol.setOffset(0, 0.5);
                   var attr = {"x":pointArr[i].x,"y":pointArr[i].y,"name":pointArr[i].name};
                   var graphic = new Graphic(point,pictureMarkerSymbol,attr);
                   var textsymbol = new TextSymbol(pointArr[i].x);
                   textsymbol.setFont(new Font("12pt").setWeight(Font.WEIGHT_BOLD));
                   textsymbol.setOffset(1, 15);
                   textsymbol.setColor(new Color([255, 0, 0, 0.8]));
                   var graphicText = new Graphic(point, textsymbol);
                   graphicLayer.add(graphic);
                   textLayer.add(graphicText);
               }
             let center = new Point(poin[0], poin[1]);
             map.centerAndZoom(center,12);
           }
           on(graphicLayer, "mouse-over", function (evt) {
               console.dir(evt.graphic.attributes)
               let html = "";
               if (evt.graphic.attributes.x != null) {
                   html += "<div style='display:flex;line-height:20px;border-bottom-width:1px; border-bottom-style:dashed; border-bottom-color:#ced5d8;'><div >" + "经度: " + "</div><div  style='padding-left:5px'>" + evt.graphic.attributes.x + "</div></div>"
               }
               if (evt.graphic.attributes.y != null) {
                   html += "<div style='display:flex;line-height:20px;border-bottom-width:1px; border-bottom-style:dashed; border-bottom-color:#ced5d8;'><div >" + "经度: " + "</div><div  style='padding-left:5px'>" + evt.graphic.attributes.x + "</div></div>"
               }
               if (evt.graphic.attributes.name != null) {
                   html += "<div  style='display:flex;line-height:20px;border-bottom-width:1px; border-bottom-style:dashed; border-bottom-color:#ced5d8;'><div >" + "名称: " + "</div><div  style='padding-left:5px'>" + evt.graphic.attributes.name + "</div></div></div>"
               }
               map.infoWindow.setTitle("位置信息");
               map.infoWindow.setContent(html);
               map.infoWindow.show(evt.mapPoint);
           })
       })
   }
  </script>
  </head>
  <body class="claro">
    <div id="mapDiv" style="z-index:1;">

     </div>
  </body>
 
